<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Web3 Gas Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
        input { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { padding: 10px 20px; margin: 5px 5px 5px 0; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px;}
        button:hover { background: #0056b3; }
        .log-box { background: #f4f4f4; padding: 10px; border: 1px solid #ddd; margin-top: 20px; min-height: 100px; white-space: pre-wrap; }
        h3 { border-bottom: 2px solid #ddd; padding-bottom: 5px; }
    </style>
</head>
<body>

    <h2>ERC-20 –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ & –†–∞—Å—á–µ—Ç –ì–∞–∑–∞</h2>
    
    <button id="connectBtn" style="background: orange;">üîå –ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
    <p>–ú–æ–π –∞–∫–∫–∞—É–Ω—Ç: <span id="myAccount">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span></p>

    <hr>

    <label>–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è / –°–ø–µ–Ω–¥–µ—Ä–∞ (Address):</label>
    <input type="text" id="addressInput" placeholder="0x..." />

    <label>–°—É–º–º–∞ (Amount):</label>
    <input type="number" id="amountInput" placeholder="10" />

    <hr>

    <h3>–§—É–Ω–∫—Ü–∏–∏:</h3>
    <div>
        <button onclick="doApprove()">3) Approve</button>
        <button onclick="doTransfer()">4) Transfer</button>
    </div>
    <div style="margin-top: 10px;">
        <button onclick="doAllowance()">2) Allowance (View)</button>
        <button onclick="doTransferFrom()">1) Transfer From</button>
    </div>

    <h3>–õ–æ–≥–∏ –∏ –ì–∞–∑:</h3>
    <div id="logs" class="log-box">–û–∂–∏–¥–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π...</div>

    <script>
        let provider, signer, contract;
        
        // !!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –ê–î–†–ï–° –í–ê–®–ï–ì–û –ö–û–ù–¢–†–ê–ö–¢–ê –ò–ó REMIX !!!
        const CONTRACT_ADDRESS = "0x73511669fd4dE447feD18BB79bAFeAC93aB7F31f"; 

        // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ABI –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞ ERC-20
        const ABI = [
            "function transfer(address to, uint amount) returns (bool)",
            "function approve(address spender, uint amount) returns (bool)",
            "function transferFrom(address from, address to, uint amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint)"
        ];

        function log(msg) {
            const logBox = document.getElementById("logs");
            logBox.innerHTML = `> ${msg}\n` + logBox.innerHTML;
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MetaMask
        document.getElementById('connectBtn').addEventListener('click', async () => {
            if (window.ethereum) {
                try {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    const address = await signer.getAddress();
                    
                    document.getElementById("myAccount").innerText = address;
                    contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
                    
                    log("MetaMask –ø–æ–¥–∫–ª—é—á–µ–Ω!");
                } catch (error) {
                    log("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " + error.message);
                }
            } else {
                alert("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask!");
            }
        });

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
        function getInputs() {
            const addr = document.getElementById("addressInput").value;
            const amt = document.getElementById("amountInput").value;
            if (!ethers.isAddress(addr)) { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –∞–¥—Ä–µ—Å!"); return null; }
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–æ –≤ Wei (18 –Ω—É–ª–µ–π)
            const amtWei = ethers.parseUnits(amt || "0", 18); 
            return { addr, amtWei };
        }

        // --- 4. TRANSFER ---
        async function doTransfer() {
            const data = getInputs();
            if (!data) return;

            try {
                log("–û—Ç–ø—Ä–∞–≤–∫–∞ Transfer...");
                const tx = await contract.transfer(data.addr, data.amtWei);
                log(`–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${tx.hash}`);
                
                const receipt = await tx.wait(); // –ñ–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
                log(`‚úÖ –£—Å–ø–µ—Ö! Gas Used: ${receipt.gasUsed.toString()}`);
            } catch (e) {
                log("–û—à–∏–±–∫–∞ Transfer: " + e.message);
            }
        }

        // --- 3. APPROVE ---
        async function doApprove() {
            const data = getInputs();
            if (!data) return;

            try {
                log("–û—Ç–ø—Ä–∞–≤–∫–∞ Approve...");
                const tx = await contract.approve(data.addr, data.amtWei);
                log(`–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${tx.hash}`);

                const receipt = await tx.wait();
                log(`‚úÖ –£—Å–ø–µ—Ö! Gas Used: ${receipt.gasUsed.toString()}`);
            } catch (e) {
                log("–û—à–∏–±–∫–∞ Approve: " + e.message);
            }
        }

        // --- 2. ALLOWANCE (–≠—Ç–æ view —Ñ—É–Ω–∫—Ü–∏—è, –≥–∞–∑–∞ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç, –Ω–æ –ø–æ–∫–∞–∂–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç) ---
        async function doAllowance() {
            const spender = document.getElementById("addressInput").value;
            if (!ethers.isAddress(spender)) return alert("–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å Spender");

            try {
                const owner = await signer.getAddress();
                const result = await contract.allowance(owner, spender);
                const formatted = ethers.formatUnits(result, 18);
                log(`‚ÑπÔ∏è Allowance: ${formatted} —Ç–æ–∫–µ–Ω–æ–≤ (View —Ñ—É–Ω–∫—Ü–∏—è - 0 –≥–∞–∑–∞)`);
            } catch (e) {
                log("–û—à–∏–±–∫–∞ Allowance: " + e.message);
            }
        }

        // --- 1. TRANSFER FROM ---
        async function doTransferFrom() {
            // –î–ª—è —Ç–µ—Å—Ç–∞ transferFrom –æ–±—ã—á–Ω–æ –Ω—É–∂–Ω–æ 3 –∞—Ä–≥—É–º–µ–Ω—Ç–∞: from, to, amount.
            // –í –ø—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–µ –º—ã –≤–æ–∑—å–º–µ–º "from" –∫–∞–∫ –Ω–∞—Å, –∞ "to" –∫–∞–∫ –≤–≤–µ–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å.
            // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –ß—Ç–æ–±—ã —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –≤—ã –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ —Å–¥–µ–ª–∞—Ç—å Approve —Å–∞–º–æ–º—É —Å–µ–±–µ –∏–ª–∏ –¥—Ä—É–≥–æ–º—É –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É.
            
            const data = getInputs();
            if (!data) return;

            try {
                const owner = await signer.getAddress(); // –û—Ç –∫–æ–≥–æ —Å–ø–∏—Å—ã–≤–∞–µ–º (–æ—Ç —Å–µ–±—è)
                log("–û—Ç–ø—Ä–∞–≤–∫–∞ TransferFrom...");
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º —Å—Ü–µ–Ω–∞—Ä–∏–∏ transferFrom –≤—ã–∑—ã–≤–∞–µ—Ç —Ç—Ä–µ—Ç—å—è —Å—Ç–æ—Ä–æ–Ω–∞. 
                // –ï—Å–ª–∏ –º—ã –≤—ã–∑—ã–≤–∞–µ–º –µ–≥–æ —Å–∞–º–∏ –Ω–∞ —Å–µ–±—è, —ç—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –µ—Å—Ç—å allowance.
                const tx = await contract.transferFrom(owner, data.addr, data.amtWei);
                log(`–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞: ${tx.hash}`);

                const receipt = await tx.wait();
                log(`‚úÖ –£—Å–ø–µ—Ö! Gas Used: ${receipt.gasUsed.toString()}`);
            } catch (e) {
                log("–û—à–∏–±–∫–∞ TransferFrom: " + e.message);
                log("–ü–æ–¥—Å–∫–∞–∑–∫–∞: –°–¥–µ–ª–∞–ª–∏ –ª–∏ –≤—ã Approve –Ω–∞ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞?");
            }
        }

    </script>
</body>
</html>