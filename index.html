<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>ERC-20 Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; padding: 20px; }
        h1 { text-align: center; color: #333; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
        .header-panel { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .status { font-weight: bold; color: #555; }
        .btn-connect { background: #e67e22; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn-connect:hover { background: #d35400; }

        /* –°–µ—Ç–∫–∞ –¥–ª—è 4 —Ñ—Ä–µ–π–º–æ–≤ */
        .grid-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* –î–≤–µ –∫–æ–ª–æ–Ω–∫–∏ */
            gap: 20px;
        }

        /* –°—Ç–∏–ª—å –∫–∞—Ä—Ç–æ—á–∫–∏ (–§—Ä–µ–π–º–∞) */
        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-top: 5px solid #ccc;
        }

        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π */
        .card-transfer { border-top-color: #3498db; } /* –°–∏–Ω–∏–π */
        .card-approve { border-top-color: #9b59b6; }  /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        .card-allowance { border-top-color: #f1c40f; } /* –ñ–µ–ª—Ç—ã–π */
        .card-transferFrom { border-top-color: #e74c3c; } /* –ö—Ä–∞—Å–Ω—ã–π */

        h3 { margin-top: 0; }
        input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        label { font-size: 12px; color: #777; font-weight: bold; }
        
        button { width: 100%; padding: 10px; border: none; border-radius: 4px; cursor: pointer; color: white; font-weight: bold; margin-top: 10px; }
        .btn-blue { background: #3498db; }
        .btn-purple { background: #9b59b6; }
        .btn-yellow { background: #f1c40f; color: #333; }
        .btn-red { background: #e74c3c; }
        button:hover { opacity: 0.8; }

        .result-box {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border: 1px dashed #ccc;
            font-size: 13px;
            color: #333;
            min-height: 40px;
            word-wrap: break-word;
        }
        .gas-tag { color: #e74c3c; font-weight: bold; display: block; margin-top: 5px; }

    </style>
</head>
<body>

    <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ERC-20 –¢–æ–∫–µ–Ω–æ–º</h1>

    <div class="header-panel">
        <div>
            <div class="status">–°—Ç–∞—Ç—É—Å: <span id="connectionStatus">üî¥ –ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</span></div>
            <div style="font-size: 12px; color: #888;" id="myAddress">–ê–¥—Ä–µ—Å: ...</div>
        </div>
        <button class="btn-connect" id="connectBtn">üîå –ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
    </div>

    <div class="grid-container">

        <div class="card card-transfer">
            <h3>1. Transfer (–ü–µ—Ä–µ–≤–æ–¥)</h3>
            <p style="font-size:12px; color:#666;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã —Å–æ —Å–≤–æ–µ–≥–æ —Å—á–µ—Ç–∞ –¥—Ä—É–≥—É.</p>
            
            <label>–ö–æ–º—É (Address To):</label>
            <input type="text" id="tx_to" placeholder="0x..." />
            
            <label>–°—É–º–º–∞:</label>
            <input type="number" id="tx_amount" placeholder="10" />

            <button class="btn-blue" onclick="doTransfer()">üí∏ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <div class="result-box" id="log_transfer">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
        </div>

        <div class="card card-approve">
            <h3>2. Approve (–†–∞–∑—Ä–µ—à–∏—Ç—å)</h3>
            <p style="font-size:12px; color:#666;">–†–∞–∑—Ä–µ—à–∏—Ç—å –¥—Ä—É–≥–æ–º—É –∞–¥—Ä–µ—Å—É (Spender) —Ç—Ä–∞—Ç–∏—Ç—å –≤–∞—à–∏ —Ç–æ–∫–µ–Ω—ã.</p>

            <label>–ö–æ–º—É —Ä–∞–∑—Ä–µ—à–∞–µ–º (Spender Address):</label>
            <input type="text" id="app_spender" placeholder="0x..." />
            
            <label>–°—É–º–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:</label>
            <input type="number" id="app_amount" placeholder="100" />

            <button class="btn-purple" onclick="doApprove()">‚úçÔ∏è –ü–æ–¥–ø–∏—Å–∞—Ç—å Approve</button>
            <div class="result-box" id="log_approve">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
        </div>

        <div class="card card-allowance">
            <h3>3. Allowance (–ü—Ä–æ–≤–µ—Ä–∫–∞)</h3>
            <p style="font-size:12px; color:#666;">–£–∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ Spender –º–æ–∂–µ—Ç —Å–Ω—è—Ç—å —É Owner.</p>

            <label>–ß—å–∏ –¥–µ–Ω—å–≥–∏ (Owner Address):</label>
            <input type="text" id="all_owner" placeholder="–ê–¥—Ä–µ—Å –≤–ª–∞–¥–µ–ª—å—Ü–∞" />
            
            <label>–ö—Ç–æ —Ç—Ä–∞—Ç–∏—Ç (Spender Address):</label>
            <input type="text" id="all_spender" placeholder="–ê–¥—Ä–µ—Å —Ç–æ–≥–æ, –∫–æ–º—É —Ä–∞–∑—Ä–µ—à–∏–ª–∏" />

            <button class="btn-yellow" onclick="doAllowance()">üëÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç</button>
            <div class="result-box" id="log_allowance">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å</div>
        </div>

        <div class="card card-transferFrom">
            <h3>4. Transfer From (–°–ø–∏—Å–∞–Ω–∏–µ)</h3>
            <p style="font-size:12px; color:#666;">–ó–∞–±—Ä–∞—Ç—å —á—É–∂–∏–µ –¥–µ–Ω—å–≥–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å Approve).</p>

            <label>–£ –∫–æ–≥–æ –∑–∞–±—Ä–∞—Ç—å (From Owner):</label>
            <input type="text" id="tf_from" placeholder="0x... (–í–ª–∞–¥–µ–ª–µ—Ü)" />

            <label>–ö–æ–º—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å (To Receiver):</label>
            <input type="text" id="tf_to" placeholder="0x... (–ü–æ–ª—É—á–∞—Ç–µ–ª—å)" />
            
            <label>–°—É–º–º–∞:</label>
            <input type="number" id="tf_amount" placeholder="5" />

            <button class="btn-red" onclick="doTransferFrom()">üîÑ –ó–∞–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
            <div class="result-box" id="log_transferFrom">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
        </div>

    </div>

    <script type="module">
        import { ethers } from "https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.min.js";

        // !!! –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –ê–î–†–ï–° –í–ê–®–ï–ì–û –ö–û–ù–¢–†–ê–ö–¢–ê !!!
        const CONTRACT_ADDRESS = "0xB581C9264f59BF0289fA76D61B2D0746dCE3C30D"; 

        const ABI = [
            "function transfer(address to, uint amount) returns (bool)",
            "function approve(address spender, uint amount) returns (bool)",
            "function transferFrom(address from, address to, uint amount) returns (bool)",
            "function allowance(address owner, address spender) view returns (uint)",
            "function decimals() view returns (uint8)"
        ];

        let provider, signer, contract;

        // --- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï ---
        window.connectWallet = async function() {
            if (!window.ethereum) return alert("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask!");
            try {
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                const address = await signer.getAddress();
                
                contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

                document.getElementById("connectionStatus").innerText = "‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ";
                document.getElementById("connectionStatus").style.color = "green";
                document.getElementById("myAddress").innerText = "–ú–æ–π –∞–¥—Ä–µ—Å: " + address;
                
                // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∞
                document.getElementById("all_owner").value = address; // –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–≤–æ–∏—Ö –ª–∏–º–∏—Ç–æ–≤
                document.getElementById("tf_to").value = address;     // –ß—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å–µ–±–µ
                
            } catch (err) {
                alert("–û—à–∏–±–∫–∞: " + err.message);
            }
        };
        // –ü—Ä–∏–≤—è–∑–∫–∞ –∫–Ω–æ–ø–∫–∏
        document.getElementById('connectBtn').addEventListener('click', window.connectWallet);


        // --- 1. TRANSFER ---
        window.doTransfer = async function() {
            if(!contract) return alert("–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫!");
            const output = document.getElementById("log_transfer");
            
            try {
                const to = document.getElementById("tx_to").value;
                const amount = ethers.parseUnits(document.getElementById("tx_amount").value, 18);
                
                output.innerText = "‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...";
                const tx = await contract.transfer(to, amount);
                
                output.innerText = "‚è≥ –ñ–¥–µ–º –º–∞–π–Ω–µ—Ä–æ–≤... Hash: " + tx.hash.substring(0,10)+"...";
                const receipt = await tx.wait();
                
                output.innerHTML = `‚úÖ –£—Å–ø–µ—Ö!<br><span class="gas-tag">‚õΩ Gas Used: ${receipt.gasUsed}</span>`;
            } catch (e) { output.innerText = "‚ùå –û—à–∏–±–∫–∞: " + e.message; }
        }


        // --- 2. APPROVE ---
        window.doApprove = async function() {
            if(!contract) return alert("–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫!");
            const output = document.getElementById("log_approve");

            try {
                const spender = document.getElementById("app_spender").value;
                const amount = ethers.parseUnits(document.getElementById("app_amount").value, 18);

                output.innerText = "‚è≥ –ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ Approve...";
                const tx = await contract.approve(spender, amount);

                output.innerText = "‚è≥ –ñ–¥–µ–º –∑–∞–ø–∏—Å–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω...";
                const receipt = await tx.wait();

                output.innerHTML = `‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤—ã–¥–∞–Ω–æ!<br><span class="gas-tag">‚õΩ Gas Used: ${receipt.gasUsed}</span>`;
            } catch (e) { output.innerText = "‚ùå –û—à–∏–±–∫–∞: " + e.message; }
        }


        // --- 3. ALLOWANCE (VIEW) ---
        window.doAllowance = async function() {
            if(!contract) return alert("–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫!");
            const output = document.getElementById("log_allowance");

            try {
                const owner = document.getElementById("all_owner").value;
                const spender = document.getElementById("all_spender").value;

                output.innerText = "üîÑ –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...";
                // –≠—Ç–æ View —Ñ—É–Ω–∫—Ü–∏—è, –æ–Ω–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –≥–∞–∑–∞ –∏ –ø–æ–¥–ø–∏—Å–∏
                const result = await contract.allowance(owner, spender);
                const formatted = ethers.formatUnits(result, 18);

                output.innerHTML = `‚ÑπÔ∏è –†–∞–∑—Ä–µ—à–µ–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å: <b>${formatted}</b> —Ç–æ–∫–µ–Ω–æ–≤.<br><span class="gas-tag">‚õΩ Gas: 0 (–ë–µ—Å–ø–ª–∞—Ç–Ω–æ)</span>`;
            } catch (e) { output.innerText = "‚ùå –û—à–∏–±–∫–∞: " + e.message; }
        }


        // --- 4. TRANSFER FROM ---
        window.doTransferFrom = async function() {
            if(!contract) return alert("–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª–µ–∫!");
            const output = document.getElementById("log_transferFrom");

            try {
                const from = document.getElementById("tf_from").value;
                const to = document.getElementById("tf_to").value;
                const amount = ethers.parseUnits(document.getElementById("tf_amount").value, 18);

                output.innerText = "‚è≥ –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤...";
                // –ú–µ—Ç–∞–º–∞—Å–∫ –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç Allowance
                const tx = await contract.transferFrom(from, to, amount);

                output.innerText = "‚è≥ –ñ–¥–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è...";
                const receipt = await tx.wait();

                output.innerHTML = `‚úÖ –°—Ä–µ–¥—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã!<br><span class="gas-tag">‚õΩ Gas Used: ${receipt.gasUsed}</span>`;
            } catch (e) { 
                output.innerText = "‚ùå –û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å—Ç—å –ª–∏ Allowance?";
                console.error(e);
            }
        }
    </script>
</body>
</html>